<!DOCTYPE html>
<!-- vue run request -->
<html>
%= include 'bootstrap/vue/header'
<body role="document">
    %= include 'bootstrap/navigation'
    <div class="container theme-showcase" role="main">
        <div id="run_request" class="jumbotron">

            <h2><%=l 'Running' %> {{domain.name}}</h2>
            <div class="alert alert-warning">
                <%=l 'A viewer is required to run the virtual machines.' %>
                <a href="/requirements"><%=l 'Read more.' %></a>
            </div>
            <div v-if="request.status != 'done'">Waiting for machine to start
                <i class="fas fa-sync-alt fa-spin"></i>
            </div>

            <div v-if="domain.id">
                <div v-if="domain.description ||(domain.is_active && domain.msg_timeout)">
                    <span v-html="domain.description">
                    </span>
                    <span v-if="domain.msg_timeout && domain.is_active">
                         <hr v-if="domain.description">
                         <%=l 'This machine will shut down' %>
                         {{domain.msg_timeout}}
                    </span>
                </div>
                <div class="panel-body" v-if="domain.is_active">
                    <h3>Display</h3>
                    %= include "/main/vue/machine_displays"
                    <h3>Machine Information</h3>
                    <ul>
                    <li><b>Internal IP:</b><span ng-show="domain.ip"> {{domain.ip}}</span>
                        <span v-if="!domain.ip"><i>waiting for network to come up</i></span>
                    </li>
                    <li><b>Max Memory:</b> {{domain.max_mem}}</li>
                    <li><b>Memory:</b> {{domain.memory}}</li>
                    <li><b>CPUs:</b> {{domain.nrVirtCpu}}</li>
                    </ul>
                </div>
                <div v-if="domain.ports.length>0 && domain.is_active">
                    <h3>Open ports</h3>
                    <div class="container pl-5">
                    <table border="0">
                        <tr v-for="port in domain.ports">
                        <td align="right">
                            <span v-if="!port.is_active" class="badge badge-danger">down</span>
                            <span v-if="port.is_active" class="badge badge-info">up</span>
                        </td>
                        <td align="left">
                            <b>{{port.name}}</b>
                        </td>
                        <td>
                            {{domain.display.ip}}:{{port.public_port}}
                            <i class="fa fa-arrow-right"></i>
                            {{port.internal_port}}
                        </td>
                        </tr>
                    </table>
                    </div>
                </div><!--ports -->
            </div><!-- show domain -->
            <div>
            <div class="panel-body">
                <div v-if="request.error && !domain.is_active">{{request.error}}</div>
                <div v-if="domain && request.status == 'done' && domain.is_active == 0"><%=l 'The machine is down.'%>
                 <button type="submit" class="btn btn-primary" onclick="location.reload('forceGet')"><%=l 'Start again'%></button>
                </div>
            </div>
            </div>

         </div><!-- run_request jumbotron -->
    </div><!-- container-->
    <script src="/js/vue/run_request.js"></script>
    <script>
        run_request.subscribe_request('<%= url_for('ws_subscribe')->to_abs %>',<%= $request->id %>);
        run_request.anonymous=<%= ($_anonymous or 0) %>;
        run_request.auto_view=<%= $auto_view %>;
    </script>
</body>

</html>
